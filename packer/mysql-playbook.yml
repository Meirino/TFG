- hosts: all
  user: ubuntu
  sudo: true
  vars:
    - root_password: root

  tasks:
    - name: Install MySQL
      apt:
        name: "{{ item }}"
      with_items:
        - mysql-server-core-5.5
        - mysql-client-core-5.5
        - libmysqlclient-dev
        - python-mysqldb
        - mysql-server
        - mysql-client

    - name: Start the MySQL service
      action: service name=mysql state=started

    - name: update mysql root password for all root accounts
      mysql_user:
        name: root
        host: "{{ item }}"
        password: "{{ mysql_root_password }}"
        priv: "*.*:ALL,GRANT"
      with_items:
        - 127.0.0.1
        - ::1
        - localhost

    - name: Remove the test database
      mysql_db: name=test state=absent

    - name: Import file.sql
      mysql_db:
        login_user: root
        login_password: root
        state: import
        name: all
        target: /home/ubuntu/sql_files/tfg.sql
